# 04 | 索引(上)

### 1、索引的常见模型
##### 1.1  哈希表

>  哈希表是key-value 存储的数据结构。哈希的思路很简单，把值放在数组里，用一个哈希函数把key换算成一个确定的位置，然后把value放在数组的这个位置。

>但是，多个key 通过哈希函数的换算可能会出现同一个值的情况，处理这种情况的一种方法是-->`拉出一个链表`

>优点：增加新的额数据会很快；  
>缺点：因为不是有序的，所以哈希做区间查询的时候速度很慢。
>总结：哈希表这种结构适用于只有等值查询的场景,如Memcached以及其他的NoSQL引擎。

##### 1.2、有序数组
> 按顺序存储，查询用二分法就可以快速查询，时间复杂度是O(log(N));  
> 有序数组的查询效率高,更新效率低  
> `有序数组索引只适用于静态存储引擎`，不会修改的数据


##### 1.3 二叉搜索树
>特点：每个节点的左儿子小于父节点，父节点小于右儿子。  
>查询、更新时间复杂度都是O(log(N))  
>数据库存储大多不适用二叉，索引不只存在内存中，还要写到磁盘中。当数据量较大时，为了让一个查尽量的少读磁盘，就必须让查询过程访问尽量少的数据块，可以使用`N叉树` ，N取决于数据块的大小。  
> N 叉树由于在读写上的性能优点，以及适配磁盘的访问模式，已经被广泛应用于数据库引擎中。

### 2、InnoDB 的索引模型
> 在InnoDB中，表都是根据主键顺序为索引的形式存放的，这种存储方式的表称为`索引组织表`；InnoDB使用了B+树索引模型，所以数据都是存在B+书中的。  
> 每一个索引在InnoDB里面对应一颗 B+ 树。  
> 主键索引的叶子节点存的是整行数据，在InnoDB里，主键索引也被称为聚簇索引;  
> 非主键索引的叶子节点内容是主键的值，在InnoDB中，非主键索引称之为二级索引。

**`基于主键索引和普通索引的查询有什么区别`**
>如果语句是 select * from T where ID = 500; 即主键查询方式，则只需要搜索ID 这个B+ 树；  
>如果语句是 select * from T where k=5 ,即普通索引查询方式，则需要先搜索 k 索引树，得到 ID 的值为 500，再到 ID 索引树搜索一次。这个过程称之为回表。  
>基于非主键索引查询需要多扫描一颗索引树，---> `在查询过程中应尽量使用主键查询`  

### 3、索引维护
> 页分裂： 如果一个数据页已经满了，根据B+ 树的算法，这时候需要申请一个新的数据页，然后挪动部分数据过去，这个过程称之为页分裂，性能会受到影响，除了性能外，页分裂还影响数据页的利用率，原本在一个页的数据，现在分到两个页中，整体空间利用率降低大约50%。  
> 页合并： 页分页的逆过程。  
**`主键长度越小，普通索引的叶子节点就越小，普通索引占用的空间也就越小`。**

**`从性能和存储空间方面考量，自增主键往往是更合理的选择`**











    

