# 2、 | 日志系统：一条SQL更新语句是如何执行的？

### 1、Redo log  物理日志
> 当有一条记录需要更新的时候，InnoDB引擎就会先把记录写到redo lof里面，并更新内存，这个时候更新就算完成了。当系统比较空闲的时候，InnoDB会将操作记录写到磁盘里面
>InnoDB 的redo log  是固定大小的，分配一组固定大小的文件，从头开始写，写到末尾就回到开头循环写。
![](./img/2.png) 
write pos 是当前记录的位置，一边写一边后移，写到末尾就会回到开头，checkpoint 是当前要擦除的位置，擦除记录前需要把记录更新到数据文件
有了redo log ,InnoDB 就可以保证即使数据库发生异常重启，之后提交的额记录不会丢失----`creash-safe`
>innodb_flush_log_at_trx_commit=1,表示每次提交的事务都会直接持久化到磁盘，保证MySQL异常重启数据不会丢失；
>


### 2、binlog 逻辑日志 归档日志
>即二进制日志,它记录了数据库上的所有改变，并以二进制的形式保存在磁盘中；它可以用来查看数据库的变更历史、数据库增量备份和恢复、Mysql的复制（主从数据库的复制）。语句以“事件”的形式保存，它描述数据更改。  
因为有了数据更新的binlog，所以可以用于实时备份，与master/slave复制。高可用与数据恢复.  
1.恢复使能够最大可能地更新数据库，因为二进制日志包含备份后进行的所有更新。  
2.在主复制服务器上记录所有将发送给从服务器的语句。

### 3、两者 的不同点
- redo log 是InnoDB引擎特有的，binlog是MySQL的Server层实现的，所有引擎都可以使用
- redo log 是物理日志，记录的是在**``在某个数据页中做了什么修改`**；binlog 是逻辑日志，记录的是这个语句的原始逻辑，
- redo log 是循环写到的，固定的空间会用完，binlog 是可以最佳写入的，并不会覆盖以前的日志。

### 4、两阶段提交
>redo log和binlog都可以用于表示事务的提交状态，两阶段提交就是让两个状态保持逻辑一致。


