# 10 | MySQL为什么有时候会选错索引？

## 1、为什么会用错索引？
> 由于平常不断地删除历史数据和新增数据的场景

## 2、优化器的逻辑
> 优化器选择索引为目的找到一个最优的执行方案，用最小的代价去执行。  
> 在数据库内，扫描行数是影响执行代价的因素之一  
>  优化器还会结合是否使用临时表，是否排序等因素进行综合判断  

## 3、扫描行数怎么判断？
> MySQL 在真正执行语句之前，并不能准确查满足条件的行数，而只能根据统计信息来估算记录数   
> 统计信息就是索引的`区分度` ,一个索引上的不同值越多，这个索引的区分度就越好，而一个索引上不同质地个数 称为   `基数`

## 4、 MySQL如何得到索引的基数？
> InnoDB 默认选择N个页面，统计这些页面上的不同值，得到一个平均值，然后乘以这个索引的页面数 --- 索引的基数  
> 数据表示持续更新的，索引的统计信息不回固定不变，当变更的数据行数超过1/M 时，会自动触发重新做一次索引统计  

> 在MySQL 中，有两种存储索引统计的方式，通过设置innodb_stats_persistent的值来选择  
> on 表示统计信息会持久化存储， 默认N= 20 ,M =10    
>off 表示信息只会存储在内存中，    N=8，M=16;

## 5、索引选择异常和处理

>1、 采用force index强行加一个索引  
>2、可以考虑修改语句，引导 MySQL 使用我们期望索引  
>3、在有些场景下，我们可以新建一个更合适的索引，来来提供给优化器做选择，或删掉误用的索引。



